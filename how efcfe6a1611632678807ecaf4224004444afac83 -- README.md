[33mcommit 1f1dd50873dadebd6c7e08550f495ba10009266a[m[33m ([m[1;31morigin/Tabula-Rasa-v3[m[33m, [m[1;32mTabula-Rasa-v3[m[33m)[m
Author: Isaiah Nwukor <isaiahnwu@gmail.com>
Date:   Sat Sep 13 20:54:05 2025 -0500

    bug fixes

[1mdiff --git a/src/utils/log_rotation.py b/src/utils/log_rotation.py[m
[1mindex 4c0532d..490e6d4 100644[m
[1m--- a/src/utils/log_rotation.py[m
[1m+++ b/src/utils/log_rotation.py[m
[36m@@ -4,6 +4,7 @@[m [mLog rotation utility for managing log file sizes[m
 [m
 import os[m
 import shutil[m
[32m+[m[32mimport time[m
 from pathlib import Path[m
 from typing import List, Optional[m
 import logging[m
[36m@@ -67,8 +68,8 @@[m [mclass LogRotator:[m
                 [m
                 outfile.writelines(lines_to_write)[m
             [m
[31m-            # Replace original with trimmed version[m
[31m-            os.replace(temp_file, log_path)[m
[32m+[m[32m            # Replace original with trimmed version (with Windows compatibility)[m
[32m+[m[32m            self._safe_replace_file(temp_file, log_path)[m
             [m
             self.logger.info(f"Log rotation complete: {log_path} now has {len(lines_to_write)} lines")[m
             return True[m
[36m@@ -77,6 +78,40 @@[m [mclass LogRotator:[m
             self.logger.error(f"Failed to rotate log file {log_path}: {e}")[m
             return False[m
     [m
[32m+[m[32m    def _safe_replace_file(self, temp_file: str, target_file: str) -> None:[m
[32m+[m[32m        """[m
[32m+[m[32m        Safely replace a file with Windows access denied handling.[m
[32m+[m[41m        [m
[32m+[m[32m        Args:[m
[32m+[m[32m            temp_file: Path to the temporary file[m
[32m+[m[32m            target_file: Path to the target file to replace[m
[32m+[m[32m        """[m
[32m+[m[32m        max_retries = 5[m
[32m+[m[41m        [m
[32m+[m[32m        for attempt in range(max_retries):[m
[32m+[m[32m            try:[m
[32m+[m[32m                # Try direct replace first (works on most systems)[m
[32m+[m[32m                os.replace(temp_file, target_file)[m
[32m+[m[32m                return[m
[32m+[m[41m                [m
[32m+[m[32m            except (OSError, PermissionError) as e:[m
[32m+[m[32m                if attempt == max_retries - 1:[m
[32m+[m[32m                    # Final attempt: use copy and delete[m
[32m+[m[32m                    try:[m
[32m+[m[32m                        shutil.copy2(temp_file, target_file)[m
[32m+[m[32m                        os.remove(temp_file)[m
[32m+[m[32m                        self.logger.warning(f"Used copy+delete fallback for log rotation: {target_file}")[m
[32m+[m[32m                        return[m
[32m+[m[32m                    except Exception as final_error:[m
[32m+[m[32m                        self.logger.error(f"All log rotation attempts failed for {target_file}: {final_error}")[m
[32m+[m[32m                        raise e[m
[32m+[m[41m                [m
[32m+[m[32m                # Wait with exponential backoff[m
[32m+[m[32m                wait_time = 0.5 * (2 ** attempt)[m
[32m+[m[32m                self.logger.warning(f"Log rotation attempt {attempt + 1} failed: {e}. Retrying in {wait_time:.1f}s...")[m
[32m+[m[32m                time.sleep(wait_time)[m
[32m+[m[32m                continue[m
[32m+[m[41m    [m
     def rotate_all_logs(self, max_lines: Optional[int] = None) -> bool:[m
         """[m
         Rotate all configured log files.[m
